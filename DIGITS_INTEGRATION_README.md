# یکپارچه‌سازی Digits برای فرم چندمرحله‌ای

## خلاصه
این پروژه یکپارچه‌سازی پلاگین Digits را برای فرم چندمرحله‌ای دامپزشک سیار پیاده‌سازی کرده است. کاربران می‌توانند بدون رفرش صفحه وارد شوند و اطلاعات فرم حفظ می‌شود.

## ویژگی‌ها

### ✅ پیاده‌سازی شده
- **فرم لاگین Digits**: جایگزین فرم ساده موبایل
- **ورود بدون رفرش**: صفحه رفرش نمی‌شود
- **حفظ اطلاعات فرم**: داده‌های مراحل قبل حفظ می‌شود
- **پشتیبانی از OTP**: ارسال و تایید کد تایید
- **ایجاد کاربر خودکار**: کاربران جدید به صورت خودکار ایجاد می‌شوند
- **استایل سفارشی**: طراحی هماهنگ با فرم اصلی

### 🔧 فایل‌های تغییر یافته

#### 1. `templates/multi-form.php`
- جایگزینی فرم موبایل ساده با `[digits_login]`
- اضافه کردن کانتینر برای پیام‌ها
- تنظیم شماره‌گذاری مراحل برای کاربران وارد شده و نشده

#### 2. `assets/css/style.css`
- اضافه کردن استایل‌های سفارشی برای فرم Digits
- پشتیبانی از حالت‌های مختلف پیام (خطا، موفقیت، اطلاعات)
- طراحی ریسپانسیو

#### 3. `assets/js/digits-integration.js` (جدید)
- مدیریت فرم Digits بدون رفرش
- حفظ و بازیابی وضعیت فرم
- مدیریت AJAX برای ارسال OTP و تایید
- تنظیم شماره‌گذاری مراحل بعد از ورود

#### 4. `vet-on-site-plugin.php`
- اضافه کردن AJAX handler برای `vos_digits_login`
- توابع `vos_send_digits_otp` و `vos_verify_digits_otp`
- تابع `vos_create_user_from_mobile` برای ایجاد کاربر جدید
- ثبت اسکریپت `digits-integration.js`

#### 5. `assets/js/main.js`
- به‌روزرسانی منطق ناوبری مراحل
- پشتیبانی از رد شدن مرحله لاگین برای کاربران وارد شده

#### 6. `assets/js/custom.js`
- حذف کدهای مربوط به فرم موبایل قدیمی

## نحوه کارکرد

### 1. نمایش فرم
- اگر کاربر وارد نشده باشد، مرحله 6 فرم Digits نمایش داده می‌شود
- اگر کاربر وارد شده باشد، مرحله 6 رد می‌شود

### 2. فرآیند ورود
1. کاربر شماره موبایل وارد می‌کند
2. کد تایید ارسال می‌شود
3. کاربر کد را وارد می‌کند
4. در صورت موفقیت، کاربر وارد می‌شود
5. مرحله لاگین مخفی می‌شود
6. شماره‌گذاری مراحل به‌روزرسانی می‌شود

### 3. حفظ اطلاعات
- وضعیت فعلی فرم در `window.vosFormData` ذخیره می‌شود
- اطلاعات کاربر در `window.vosUserData` ذخیره می‌شود

## API Endpoints

### `vos_digits_login`
**Method**: POST  
**Parameters**:
- `mobile`: شماره موبایل
- `otp`: کد تایید (اختیاری)
- `_ajax_nonce`: نانس امنیتی

**Response**:
```json
{
  "success": true,
  "data": {
    "message": "ورود موفقیت‌آمیز بود",
    "user_id": 123,
    "phone": "09123456789",
    "logged_in": true
  }
}
```

## تست

### فایل تست
`digits-integration-test.php` برای تست عملکرد یکپارچه‌سازی ایجاد شده است.

### نحوه تست
1. فایل تست را در مرورگر باز کنید
2. وضعیت Digits را بررسی کنید
3. فرم لاگین را تست کنید
4. بررسی کنید که ورود بدون رفرش انجام می‌شود

## نکات مهم

### امنیت
- تمام درخواست‌ها با نانس محافظت می‌شوند
- شماره موبایل اعتبارسنجی می‌شود
- کد تایید محدودیت زمانی دارد

### سازگاری
- با نسخه‌های مختلف Digits سازگار است
- از jQuery برای AJAX استفاده می‌کند
- با فرم چندمرحله‌ای موجود سازگار است

### عملکرد
- فرم بدون رفرش کار می‌کند
- اطلاعات فرم حفظ می‌شود
- تجربه کاربری بهبود یافته

## عیب‌یابی

### مشکلات رایج

#### 1. فرم Digits نمایش داده نمی‌شود
- بررسی کنید که پلاگین Digits فعال است
- بررسی کنید که shortcode `[digits_login]` کار می‌کند

#### 2. کد تایید ارسال نمی‌شود
- تنظیمات SMS Digits را بررسی کنید
- درگاه SMS فعال را بررسی کنید

#### 3. ورود بدون رفرش کار نمی‌کند
- فایل `digits-integration.js` را بررسی کنید
- کنسول مرورگر را برای خطاها بررسی کنید

### لاگ‌ها
تمام عملیات در کنسول مرورگر لاگ می‌شوند:
```javascript
console.log('Digits integration script loaded');
console.log('Handling Digits form submission...');
console.log('Digits login/signup successful:', data);
```

## آینده

### بهبودهای پیشنهادی
- اضافه کردن پشتیبانی از ورود با ایمیل
- بهبود مدیریت خطاها
- اضافه کردن انیمیشن‌های بیشتر
- پشتیبانی از ورود با شبکه‌های اجتماعی

### نگهداری
- به‌روزرسانی منظم با نسخه‌های جدید Digits
- تست منظم عملکرد
- بررسی سازگاری با تغییرات WordPress 